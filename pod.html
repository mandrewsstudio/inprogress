<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Podcast Downloader</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; background: #f9f9f9; }
    h1 { font-size: 1.5rem; }
    .podcast { background: white; padding: 1rem; margin: 1rem 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,.1); }
    button { margin-top: 1rem; padding: 0.5rem 1rem; border: none; border-radius: 6px; background: #0073e6; color: white; cursor: pointer; }
    button:hover { background: #005bb5; }
    a { text-decoration: none; color: #0073e6; }
  </style>
</head>
<body>
  <h1>Podcast Downloader</h1>

  <div id="podcasts"></div>
  <button id="downloadAll">Download All</button>

  <script>
    const feeds = [
      "https://www.patreon.com/rss/TrueAnonPod?auth=hKdIt5W4DDPnMWtHxiDgBFyNYdsLHYqP&show=875184",
      "https://www.patreon.com/rss/qanonanonymous?auth=P4-Ip25HWu7WnmcrLXaIVUDFhChJFppQ&show=868249",
      "https://rss.wbur.org/endlessthread/podcast"
    ];

    async function fetchFeed(url) {
      try {
        const res = await fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url));
        const data = await res.json();
        const parser = new DOMParser();
        const xml = parser.parseFromString(data.contents, "application/xml");
        const title = xml.querySelector("channel > title")?.textContent || "Unknown Podcast";
        const item = xml.querySelector("item");
        const epTitle = item?.querySelector("title")?.textContent || "Latest Episode";
        const enclosure = item?.querySelector("enclosure")?.getAttribute("url");
        return { podcast: title, epTitle, enclosure };
      } catch (e) {
        console.error("Error fetching", url, e);
        return null;
      }
    }

    async function loadPodcasts() {
      const container = document.getElementById("podcasts");
      const results = await Promise.all(feeds.map(fetchFeed));
      results.forEach(r => {
        if (!r || !r.enclosure) return;
        const div = document.createElement("div");
        div.className = "podcast";
        div.innerHTML = `
          <h2>${r.podcast}</h2>
          <p><strong>Episode:</strong> ${r.epTitle}</p>
          <a href="${r.enclosure}" download>Download MP3</a>
        `;
        container.appendChild(div);
      });
    }

    async function downloadAll() {
      const links = document.querySelectorAll(".podcast a");
      links.forEach(link => {
        const a = document.createElement("a");
        a.href = link.href;
        a.download = "";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      });
    }

    document.getElementById("downloadAll").addEventListener("click", downloadAll);

    loadPodcasts();
  </script>
</body>
</html>
